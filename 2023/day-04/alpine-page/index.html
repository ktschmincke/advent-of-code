<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>AoC 2023 Day 4</title>

        <script
            defer
            src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
        ></script>
        <link rel="stylesheet" href="https://unpkg.com/papercss@1.9.2/dist/paper.min.css">
        <style>
            body {
                max-width: 60rem;
                margin: 40px auto;
                padding: 0 4rem;
            }

            .scratch-card-list {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(15rem, 1fr));
                gap: 1rem;
            }

            .number-list {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(3rem, 1fr));
                gap: 1rem;
            }

            .number {
                display: grid;
                place-items: center;
                padding: 4px;
                font-size: 2rem;
                aspect-ratio: 1;
            }

            .badge {
                font-size: 1.2rem;
            }
        </style>
    </head>
    <body>
        <div x-data="scratchCardData">

            <h1 x-text="'Total Score: ' + totalScore"></h1>

            <div class="scratch-card-list">
                <template x-for="card in cards" :key="card.id">
                    <div class="card">
                        <div class="card-body">
                            <div class="row flex-edges flex-middle">
                                <h2 class="card-title" x-text="'Card ' + card.id"></h2>
                                <span class="badge secondary" x-text="card.score + ' points!'"></span>
                            </div>
                            <h3 class="card-subtitle">Winning Numbers</h3>
                            <div class="number-list child-borders">
                                <template x-for="num in card.winningNumbers">
                                    <span
                                        class="number"
                                        :class="{ 'background-success': card.matchingNumbers.includes(num) }"
                                        x-text="num"
                                    ></span>
                                </template>
                            </div>
                            <h3 class="card-subtitle" style="margin-top: 20px;">Your Numbers</h3>
                            <div class="number-list child-borders">
                                <template x-for="num in card.scratchedNumbers">
                                    <span
                                        class="number"
                                        :class="{ 'background-success': card.matchingNumbers.includes(num) }"
                                        x-text="num"
                                    ></span>
                                </template>
                            </div>
                        </div>
                    </div>
                </template>
            </div>

        </div>

        <script>
            document.addEventListener('alpine:init', () => {
                Alpine.data('scratchCardData', () => ({
                    input: testInput,

                    get cards() {
                        return this.input
                            .trim()
                            .split(/\s*\n\s*/)
                            .map((line) => {
                                const re =
                                    /Card\s+(\d+):\s+((?:\d+\s+)+)\|\s+((?:\d+\s*)+)/;
                                const [_, id, winning, scratched] =
                                    re.exec(line);

                                const winningNumbers = winning
                                    .trim()
                                    .split(/\s+/);
                                const scratchedNumbers = scratched
                                    .trim()
                                    .split(/\s+/);

                                const matchingNumbers = scratchedNumbers.filter(
                                    (i) => winningNumbers.includes(i)
                                );

                                return {
                                    id,
                                    winningNumbers,
                                    scratchedNumbers,
                                    matchingNumbers,
                                    numMatches: matchingNumbers.length,
                                    score: Math.floor(
                                        Math.pow(2, matchingNumbers.length - 1)
                                    ),
                                };
                            });
                    },

                    get totalScore() {
                        return this.cards.reduce(
                            (sum, card) => sum + card.score,
                            0
                        );
                    },
                }));
            });

            const testInput = `
                Card 1: 41 48 83 86 17 | 83 86  6 31 17  9 48 53
                Card 2: 13 32 20 16 61 | 61 30 68 82 17 32 24 19
                Card 3:  1 21 53 59 44 | 69 82 63 72 16 21 14  1
                Card 4: 41 92 73 84 69 | 59 84 76 51 58  5 54 83
                Card 5: 87 83 26 28 32 | 88 30 70 12 93 22 82 36
                Card 6: 31 18 13 56 72 | 74 77 10 23 35 67 36 11
            `;
        </script>
    </body>
</html>
